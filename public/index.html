<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabla de Datos</title>
<script>
        async function fetchData() {
            const response = await fetch('/api/data');
            const data = await response.json();
            const tableBody = document.getElementById('table-body');
            tableBody.innerHTML = '';

            data.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.id_parcelacion}</td>
                    <td>${row.latitud}</td>
                    <td>${row.longitud}</td>
                    <td>${row.id_sector}</td>
                    <td>${row.id_fase}</td>
                    <td>${row.id_cultivo}</td>
                    <td>${row.registrada}</td>
                    <td>
                        <button onclick="editProduct(${row.id_parcelacion})">Editar</button>
                        <button onclick="deleteProduct(${row.id_parcelacion})">Eliminar</button>
                    </td>
                `;
                tableBody.appendChild(tr);
            });
        }

        async function createProduct() {
            const latitud = document.getElementById('latitud').value;
            const longitud = document.getElementById('longitud').value;
            const id_sector = document.getElementById('id_sector').value;
            const id_fase = document.getElementById('id_fase').value;
            const id_cultivo = document.getElementById('id_cultivo').value;
            const registrada = document.getElementById('registrada').value; 
            await fetch('/api/data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ latitud, longitud, id_sector, id_fase, id_cultivo , registrada}),
            });
            fetchData();
        }
        window.onload = async () => {
    await loadSelectOptions(); // Carga las opciones
    await fetchData(); // Carga los datos
};

    </script>
</head>
<body>
    <h1>Datos de la Tabla</h1>
    <input type="file" name="image" accept="image/*" required>
    <input type="number" name="latitud" placeholder="Latitud" step="any" min="-90" max="90" required>
    <input type="number" name="longitud" placeholder="Longitud" step="any" min="-180" max="180" required>
    <select name="id_sector" id="id_sector" required>
      <option value="">Seleccione un Sector</option>
      <!-- Las opciones se llenarán aquí con JavaScript -->
  </select>

  <select name="id_fase" id="id_fase" required>
      <option value="">Seleccione una Fase</option>
      <!-- Las opciones se llenarán aquí con JavaScript -->
  </select>

  <select name="id_cultivo" id="id_cultivo" required>
      <option value="">Seleccione un Cultivo</option>
      <!-- Las opciones se llenarán aquí con JavaScript -->
  </select>

  <select name="registrada" required>
      <option value="">Seleccione si esta registrada</option>
      <option value="0">No Registrada</option>
      <option value="1">Registrada</option>
  </select>
    <button onclick="createProduct()">Crear Producto</button>
    <table border="1">
        <thead>
            <tr>
                <th>id_parcelacion</th>
                <th>latitud</th>
                <th>longitud</th>
                <th>id_sector</th>
                <th>id_fase</th>
                <th>id_cultivo</th>
                <th>registrada</th>
                <!-- Agrega más encabezados según tu tabla -->
            </tr>
        </thead>
        <tbody id="table-body">
            <!-- Los datos se agregarán aquí -->
        </tbody>
    </table>
</body>
</html>
